# テスト計画書

## プロジェクト名
VCバーコミュニティアプリ

## テスト方針

### TDD（Test-Driven Development）原則の遵守
1. **Red**: テスト作成（実装コードは書かない）
2. **仕様確認**: テストの意図を日本語で説明
3. **テスト実行**: 失敗確認 → コミット
4. **Green**: 実装（テストは変更しない）
5. **Refactor**: リファクタリング（テスト維持）

---

## テスト種類

### 1. Unit Test（単体テスト）
**目的**: 個別の関数・コンポーネントの動作確認
**ツール**: Jest / Vitest
**対象**:
- ユーティリティ関数
- バリデーション関数
- データ変換ロジック

### 2. Integration Test（統合テスト）
**目的**: API・DB連携の動作確認
**ツール**: Jest + Firebase Emulator Suite
**対象**:
- Firebase Authentication連携
- Firestore CRUD操作
- Cloud Storage操作

### 3. E2E Test（エンドツーエンドテスト）
**目的**: ユーザーフロー全体の動作確認
**ツール**: Detox（React Native）
**対象**:
- ログイン → チェックイン → チェックアウトフロー
- プロフィール作成 → 編集フロー
- 在館者リスト表示 → プロフィール詳細閲覧

---

## テスト環境

### 開発環境
- **OS**: macOS / Windows / Linux
- **Node.js**: v18以上
- **React Native CLI**: 最新版
- **Firebase Emulator Suite**: ローカルFirebase環境

### テストデバイス
- **iOS**: iPhone 12以降（iOS 15+）
- **Android**: Pixel 5以降（Android 11+）
- **シミュレーター**: iOS Simulator, Android Emulator

---

## テストケース一覧

### 認証機能（Authentication）

#### TC-001: 新規登録（正常系）
- **前提条件**: アプリ初回起動
- **手順**:
  1. 「新規登録」ボタンをタップ
  2. メールアドレス、パスワードを入力
  3. 「登録」ボタンをタップ
- **期待結果**:
  - ユーザーが作成される
  - ホーム画面に遷移する
  - Firebase Authenticationにユーザーが登録される

#### TC-002: 新規登録（異常系：メールアドレス重複）
- **前提条件**: 既存ユーザーのメールアドレスを使用
- **手順**: TC-001と同じ
- **期待結果**:
  - エラーメッセージ「このメールアドレスは既に使用されています」が表示される
  - ユーザーは作成されない

#### TC-003: ログイン（正常系）
- **前提条件**: 既存ユーザーアカウントあり
- **手順**:
  1. メールアドレス、パスワードを入力
  2. 「ログイン」ボタンをタップ
- **期待結果**:
  - ログイン成功
  - ホーム画面に遷移する

#### TC-004: ログイン（異常系：パスワード間違い）
- **前提条件**: 既存ユーザーアカウントあり
- **手順**: TC-003で間違ったパスワードを入力
- **期待結果**:
  - エラーメッセージ「パスワードが正しくありません」が表示される
  - ログインできない

#### TC-005: ソーシャルログイン（Google）
- **前提条件**: Googleアカウントあり
- **手順**:
  1. 「Googleでログイン」ボタンをタップ
  2. Googleアカウントを選択
- **期待結果**:
  - ログイン成功
  - ホーム画面に遷移する

#### TC-006: ログアウト
- **前提条件**: ログイン済み
- **手順**:
  1. マイページに移動
  2. 「ログアウト」ボタンをタップ
- **期待結果**:
  - ログアウト成功
  - ログイン画面に遷移する

---

### プロフィール機能（Profile）

#### TC-101: プロフィール作成（正常系）
- **前提条件**: 新規登録直後
- **手順**:
  1. プロフィール写真をアップロード
  2. 氏名、役割、所属、スキル、興味を入力
  3. 「保存」ボタンをタップ
- **期待結果**:
  - Firestoreの`/users/{userId}`にデータが保存される
  - 「保存しました」メッセージが表示される

#### TC-102: プロフィール編集（正常系）
- **前提条件**: プロフィール作成済み
- **手順**:
  1. マイページから「編集」ボタンをタップ
  2. 氏名を変更
  3. 「保存」ボタンをタップ
- **期待結果**:
  - Firestoreのデータが更新される
  - マイページに反映される

#### TC-103: プロフィール画像アップロード（正常系）
- **前提条件**: プロフィール作成済み
- **手順**:
  1. 画像選択ボタンをタップ
  2. ギャラリーから画像を選択
  3. 「保存」ボタンをタップ
- **期待結果**:
  - Cloud Storageに画像がアップロードされる
  - プロフィールに画像が表示される

#### TC-104: プロフィール画像アップロード（異常系：5MB超過）
- **前提条件**: プロフィール作成済み
- **手順**: TC-103で5MB以上の画像を選択
- **期待結果**:
  - エラーメッセージ「画像サイズは5MB以下にしてください」が表示される
  - アップロードが中止される

---

### チェックイン/アウト機能（Check-in/out）

#### TC-201: チェックイン（正常系）
- **前提条件**: ログイン済み
- **手順**:
  1. ホーム画面の「チェックイン」ボタンをタップ
  2. 滞在目的を選択（例: Networking）
  3. 「チェックイン」ボタンをタップ
- **期待結果**:
  - Firestoreの`/presence/{userId}`の`isPresent`がtrueになる
  - Realtime Databaseも更新される
  - 在館者リストに自分が表示される

#### TC-202: チェックアウト（正常系）
- **前提条件**: チェックイン済み
- **手順**:
  1. 「チェックアウト」ボタンをタップ
- **期待結果**:
  - `isPresent`がfalseになる
  - 在館者リストから消える

#### TC-203: 自動チェックアウト
- **前提条件**: チェックイン済み（滞在予定時間6時間）
- **手順**:
  1. 6時間経過を待つ（テストでは時間を短縮）
- **期待結果**:
  - 6時間後に自動的に`isPresent`がfalseになる

#### TC-204: リアルタイム同期確認
- **前提条件**: 2台のデバイスでログイン
- **手順**:
  1. デバイスAでチェックイン
  2. デバイスBで在館者リストを確認
- **期待結果**:
  - デバイスBに即座にデバイスAのユーザーが表示される（1秒以内）

---

### 在館者リスト表示（Presence List）

#### TC-301: 在館者リスト表示（正常系）
- **前提条件**: 複数ユーザーがチェックイン済み
- **手順**:
  1. ホーム画面を開く
- **期待結果**:
  - チェックイン中のユーザーが全員表示される
  - プロフィール写真、名前、役割が表示される

#### TC-302: 在館者フィルター（役割別）
- **前提条件**: VC、学生、起業家が混在してチェックイン
- **手順**:
  1. フィルターで「VC」を選択
- **期待結果**:
  - VCのみが表示される

#### TC-303: 在館者数表示
- **前提条件**: 10名がチェックイン済み
- **手順**:
  1. ホーム画面を開く
- **期待結果**:
  - 「在館者: 10名」と表示される

#### TC-304: Pull to Refresh
- **前提条件**: ホーム画面表示中
- **手順**:
  1. 画面を下に引っ張る
- **期待結果**:
  - 在館者リストが再取得される
  - 最新の状態に更新される

---

### プロフィール詳細画面（Profile Detail）

#### TC-401: プロフィール詳細表示（正常系）
- **前提条件**: 在館者リストに他のユーザーが表示されている
- **手順**:
  1. ユーザーのプロフィールをタップ
- **期待結果**:
  - プロフィール詳細画面が表示される
  - 名前、役割、所属、スキル、興味が表示される
  - 在館状態（オンライン/オフライン）が表示される

---

### プッシュ通知（Push Notification）

#### TC-501: チェックイン通知（正常系）
- **前提条件**: 通知許可済み
- **手順**:
  1. 他のユーザーがチェックイン
- **期待結果**:
  - 「〇〇さんが来館しました！」通知が届く

#### TC-502: 通知設定OFF
- **前提条件**: マイページで通知をOFF
- **手順**:
  1. 他のユーザーがチェックイン
- **期待結果**:
  - 通知が届かない

---

### 検索・フィルター機能（Search & Filter）

#### TC-601: 名前検索（正常系）
- **前提条件**: 複数ユーザー登録済み
- **手順**:
  1. 検索ボックスに「田中」と入力
- **期待結果**:
  - 「田中」を含むユーザーのみが表示される

#### TC-602: スキルタグ検索（正常系）
- **前提条件**: 複数ユーザー登録済み
- **手順**:
  1. スキルタグ「AI」をタップ
- **期待結果**:
  - スキルに「AI」を持つユーザーのみが表示される

---

## パフォーマンステスト

### PT-001: 在館者50名時の表示速度
- **目標**: 1秒以内にリスト表示
- **手順**:
  1. 50名のテストユーザーをチェックイン状態にする
  2. ホーム画面を開く
- **期待結果**:
  - 1秒以内に全ユーザーが表示される

### PT-002: 画像読み込み最適化
- **目標**: 遅延読み込み（Lazy Loading）
- **手順**:
  1. 50名の在館者リストをスクロール
- **期待結果**:
  - スクロールに合わせて画像が順次読み込まれる
  - スクロールが滑らか（60fps維持）

---

## セキュリティテスト

### ST-001: Firestore Security Rules（読み取り）
- **手順**:
  1. 未ログイン状態で`/users`を取得
- **期待結果**:
  - `permission-denied`エラーが返される

### ST-002: Firestore Security Rules（書き込み）
- **手順**:
  1. ユーザーAでログイン
  2. ユーザーBのプロフィールを更新しようとする
- **期待結果**:
  - `permission-denied`エラーが返される

### ST-003: Cloud Storage（画像アップロード権限）
- **手順**:
  1. ユーザーAでログイン
  2. ユーザーBのパスに画像をアップロード
- **期待結果**:
  - `permission-denied`エラーが返される

---

## 回帰テスト（Regression Test）

### 実施タイミング
- 新機能追加時
- バグ修正時
- リリース前

### 対象テストケース
- 全TC（TC-001 〜 TC-602）
- 全パフォーマンステスト（PT-001 〜 PT-002）
- 全セキュリティテスト（ST-001 〜 ST-003）

---

## テスト自動化

### 自動化対象
- Unit Test: 100%
- Integration Test: 80%以上
- E2E Test: 主要フロー（ログイン、チェックイン、プロフィール編集）

### CI/CD統合
- GitHub Actionsで自動実行
- プルリクエスト作成時にテスト実行
- mainブランチマージ前にテスト通過必須

---

## テストデータ

### テストユーザー
```javascript
const testUsers = [
  { email: "vc1@example.com", role: "VC", name: "山田太郎" },
  { email: "student1@example.com", role: "Student", name: "田中花子" },
  { email: "entrepreneur1@example.com", role: "Entrepreneur", name: "佐藤一郎" }
];
```

### Firebase Emulator使用
- Authentication: localhost:9099
- Firestore: localhost:8080
- Realtime Database: localhost:9000
- Cloud Storage: localhost:9199

---

## バグ管理

### バグ報告フォーマット
```markdown
## バグタイトル
[機能名] 簡潔な説明

## 再現手順
1. XXXをする
2. YYYをタップ
3. ZZZが表示される

## 期待動作
〇〇が表示されるべき

## 実際の動作
△△が表示される

## 環境
- OS: iOS 16.0
- デバイス: iPhone 14
- アプリバージョン: 1.0.0
```

---

## テストスケジュール

| Week | テスト内容 |
|------|-----------|
| Week 1 | テストケース作成、Firebase Emulator環境構築 |
| Week 2 | Unit Test実装、認証機能テスト |
| Week 3 | Integration Test実装、チェックイン機能テスト |
| Week 4 | E2E Test実装、回帰テスト、バグフィックス |

---

**最終更新日**: 2025-11-15
